{% extends 'base.html' %}
{% block content %}
<div>
    <form action="/", method='GET'>
       <button type="submit" id="log-out-button">Log Out</button>
   </form>
</div>
<div>
    <form action="/employees/{{employee.employee_id}}", method='GET'>
       <button type="submit" id="previous-button">previous page</button>
   </form>
</div>

{% for game in games %}


    <div class="game">
        <div class="game-info">
            <h4 id="game_name" name="game_name">{{ game.game_name }}</h4> 
            <p>{{ game.store }}</p>
            <img src="{{ game.image }}"" height="200" width="200" class="image">
        </div>
        <div class="game-search">
            <form
                class="game-search-form"
                action="/employees/{{employee.employee_id}}/kidsappbox_game"
                method="GET"
                data-gameid="{{ game.game_id }}"
            >
       
                <button type="submit" class="btn btn primary">See Games Rating Distribution</button>
            </form>
        </div>
        <div style="width: 300px; height: 300px;" class="game-chart">
            <canvas id="chart-{{ game.game_id }}">
                
            </canvas>
            <div id="legend-{{ game.game_id }}"></div>
        </div>
    </div>
    
{% endfor %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <script>

   $(document).ready(function(){
      $('#log-out-button').on('click', (evt) => {
       evt.preventDefault();
       console.log('you are succesfully log out')
       window.location.href = "/logout"
        });
    });
    

    $('.game-search-form').on('submit', (evt) => {
        evt.preventDefault();
        const gameId = $(evt.target).data('gameid');
        console.log(gameId);
        console.log(evt.target);

        $.get(`/game-data/${gameId}`, data => {
            if (data === 'No data for this game') {
                $(`#legend-${gameId}`).append('No data for this game');
            } else if(data ==="You've exceeded the rate limit for the API you're trying to access"){
               window.alert("You've exceeded the rate limit for the API you're trying to access")
            }
            else {
                const ctx = $(`#chart-${gameId}`).get(0).getContext('2d');
                const donutChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: { responsive: true}
                });
                // $(`#legend-${gameId}`).html(donutChart.generateLegend());
            }
        });
    });
 
  </script>
{% endblock %}


