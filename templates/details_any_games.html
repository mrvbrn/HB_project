{% extends 'base.html' %}

{% block content %}

<style>
  table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 70%;
      }

  td, th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
      }

  tr:nth-child(even) {
      background-color: #dddddd;
      }
</style>
<div>
    <form action="/", method='GET'>
       <button type="submit" id="log-out-button">Log Out</button>
   </form>
</div>
<h2>search details of  games</h2>
<form id="select_form" method="POST">
  <div class="form_group">
  	  <label>Store</label>
    <select id="store_type_field" name="store_type" class="store_control">
			  <option value="android">android</option>
			  <option value="itunes">itunes</option>
		</select>
  </div>

  <div class="form_group">
      <label>Country</label>
    <select id="country_type_field" name="country_type" class="country_control">
			 <option value="AU" id = "select_country">Australia</option>
			 <option value="CAN" id = "select_country">Canada</option>
			 <option value="CHN" id = "select_country">Chinese</option>
			 <option value="FR" id = "select_country">France</option>
			 <option value="DE" id = "select_country">Germany</option>
			 <option value="GB" id = "select_country">United Kingdom</option>
			 <option value="US" id = "select_country">US</option>
    </select>
    
  </div>
  
  <div class="form_group">
      <label>App Id</label>
    <input class="app_id_contol" type="text" name="app_id_type" id="app_id_type_field" required>
   
  </div>

  <div class="form_group">
  	  <button type="submit" id="search-form-button" class="btn btn primary">Search</button>
  </div>
  <br><br>
</form>

  <div id="details_game">
    <table>
    <tr>
       <th>App Name:</th>
       <td><span id="app_name">*</td>
    </tr>
    <tr>
       <th>Genre:</th>
       <td><span id="genre">*</td>
    </tr>
    <tr>
       <th>Average Rating:</th>
    <td><span id="rating">*</td>
    </tr>
    <tr>
      <th>Price:</th>
    <td><span id="price">*</td>
    </tr>
    </table>
  </div>
   <div style="width: 200px; height: 200px;" class="game-chart">
            <canvas id="chart">
                
            </canvas>
            <div id="legend"></div>
        </div>
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('#log-out-button').on('click', (evt) => {
    evt.preventDefault();
    console.log('you are succesfully log out')
    window.location.href = "/logout"
  });
});
 
  $("#search-form-button").on('click', (evt) => {
      evt.preventDefault();
      searchGames();
      searchRating();
       });

    function searchRating(){

      const country = $("#country_type_field").val();
      const store = $("#store_type_field").val();
      const app_id =  $("#app_id_type_field").val();

      const formData = {
                country_type: country,
                store_type: store,
                app_id_type: app_id

      };
    
     

    

      $.post(`/details_any_games`, formData, data => {
        // throw 'break';
        const histogram = data.all_histogram;
        const ctx = $(`#chart`).get(0).getContext('2d');
        const donutChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            datasets: [{
              data: Object.values(histogram),
              backgroundColor: [
                "#FF6384",
                "#36A2EB",
                "#FFCE56",
                "purple",
                "yellow"
              ],
              "hoverBackgroundColor": [
                "#FF6384",
                 "#36A2EB",
                 "#FFCE56",
                 "purple",
                 "yellow"
              ],
            }],
            labels: Object.keys(histogram),
          },
          options: { 
            responsive: true,
            // maintainAspectRatio: false
          }
      });
              
      $(`#legend`).html(donutChart.generateLegend());
                
              
           
    });
  }
    function showResults(json_record) {

  $('#app_name').html(json_record["app_name"]);
  $('#price').html(json_record["price"]);
  $('#genre').html(json_record["genre"]);
}


function searchGames() {

    let formInputs = {
        "country_type": $("#country_type_field").val(),
        "store_type": $("#store_type_field").val(),
        "app_id_type": $("#app_id_type_field").val()
    };


    $.post("/details_any_games", formInputs, showResults);
}
   
</script>



<!--   <div id="details_game">
    <ul>
    <li><b>app_name: <span id='app_name'>Unknown</span></li>
    <li>genre: <span id='genre'>Unknown</span></li>
    <li>price: <span id='price'>Unknown</span></li>
   </ul>
  </div>	

<script src="http://code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="/static/any-games.js"></script>
<script type="text/javascript">
  $("#search-form-button").on('click', (evt) => {
      evt.preventDefault();
      searchGames();
    });
</script> -->



{% endblock %}
